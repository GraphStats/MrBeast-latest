<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Vidéos de MrBeast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://github.hubspot.com/odometer/themes/odometer-theme-default.css" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      background-color: #000;
      color: #fff;
      font-weight: 900;
    }

    #main {
     font-family: 'Roboto', sans-serif;
      padding: 80px 20px;
      display: flex;
      justify-content: center;
    }

    .video-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      max-width: 1200px;
      width: 100%;
    }

    .video-item {
      width: 100%;
      max-width: 400px;
    }

    .thumbnail-container {
      width: 100%;
      padding-top: 56.25%;
      position: relative;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .thumbnail-container img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      top: 0;
      left: 0;
    }

    .video-item h3 {
      font-size: 1.5em;
      margin: 0 0 10px;
    }

    .odometer {
      font-family: 'Roboto', sans-serif !important;
      font-size: 3em;
    }

    .views {
      color: #00bfff;
    }

    .likes {
      color: #32cd32;
    }

    p {
      margin: 5px 0;
    }
  </style>
  <script src="https://github.hubspot.com/odometer/odometer.js"></script>
</head>
<body>
  <div id="main">
    <div class="video-list">
      <div class="video-item">
        <div class="thumbnail-container">
          <img id="mrbeast-video-thumbnail" src="https://via.placeholder.com/300x200?text=Chargement..." alt="Miniature de la vidéo">
        </div>
        <h3 id="mrbeast-video-title">Chargement...</h3>
        <p><span id="mrbeast-video-views" class="odometer views">0</span></p>
        <p><span id="mrbeast-video-likes" class="odometer likes">0</span></p>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = 'AIzaSyCGEt9BCzNHb__M37X3DVRZvBr_bZ6AXig';
    const MRBEAST_CHANNEL_ID = 'UCX6OQ3DkcsbYNE6H8uQQuVA';

    const elements = {
      title: document.getElementById('mrbeast-video-title'),
      thumbnail: document.getElementById('mrbeast-video-thumbnail'),
      views: document.getElementById('mrbeast-video-views'),
      likes: document.getElementById('mrbeast-video-likes'),
    };

    function parseISODuration(duration) {
      const regex = /PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/;
      const matches = duration.match(regex) || [];
      const hours = parseInt(matches[1] || 0);
      const minutes = parseInt(matches[2] || 0);
      const seconds = parseInt(matches[3] || 0);
      return hours * 3600 + minutes * 60 + seconds;
    }

    async function fetchLatestShortVideoId() {
      try {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${MRBEAST_CHANNEL_ID}&maxResults=10&order=date&type=video&key=${API_KEY}`);
        const data = await res.json();
        for (const item of data.items) {
          const videoId = item.id.videoId;
          const detailsRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${videoId}&key=${API_KEY}`);
          const details = await detailsRes.json();
          const duration = parseISODuration(details.items[0].contentDetails.duration);
          if (duration <= 120) return videoId;
        }
        throw new Error('Aucune vidéo courte trouvée');
      } catch (err) {
        console.error('Erreur vidéos:', err.message);
        return null;
      }
    }

    async function fetchVideoStats(videoId) {
      try {
        const res = await fetch(`https://backend.mixerno.space/api/youtube/video/${videoId}`);
        const data = await res.json();
        const item = data.items[0];
        elements.title.textContent = item.snippet.title || 'Titre inconnu';
        elements.thumbnail.src = item.snippet.thumbnails.medium.url || 'https://via.placeholder.com/300x200?text=Pas+de+miniature';
        elements.views.innerText = item.statistics.viewCount || '0';
        elements.likes.innerText = item.statistics.likeCount || '0';
      } catch (err) {
        console.error('Erreur stats:', err.message);
      }
    }

    let currentVideoId = null;

    async function init() {
      currentVideoId = await fetchLatestShortVideoId();
      if (currentVideoId) {
        await fetchVideoStats(currentVideoId);
        setInterval(() => fetchVideoStats(currentVideoId), 5000);
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
